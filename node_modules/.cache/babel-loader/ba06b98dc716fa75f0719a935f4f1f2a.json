{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\work\\\\client\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _slicedToArray from\"D:\\\\work\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'./authContext';import AuthReducer from'./authReducer';import axois from'axios';import SetAuthToken from'../../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../type';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),isAuthenticated:null,loading:true,error:null,user:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// load user \nvar loadUser=function loadUser(){var res;return _regeneratorRuntime.async(function loadUser$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.token)SetAuthToken(localStorage.token);_context.prev=1;_context.next=4;return _regeneratorRuntime.awrap(axois.get('/api/auth'));case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:;case 12:case\"end\":return _context.stop();}}},null,null,[[1,8]]);};// Register User \nvar registerUser=function registerUser(FormData){var config,res;return _regeneratorRuntime.async(function registerUser$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{'Content-Type':'application/json'}};_context2.prev=1;_context2.next=4;return _regeneratorRuntime.awrap(axois.post('/api/users',FormData,config));case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},null,null,[[1,9]]);};// Login user \nvar login=function login(FormData){var config,res;return _regeneratorRuntime.async(function login$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{'Content-Type':'application/json'}};_context3.prev=1;_context3.next=4;return _regeneratorRuntime.awrap(axois.post('/api/auth',FormData,config));case 4:res=_context3.sent;dispatch({type:LOGIN_SUCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:;case 13:case\"end\":return _context3.stop();}}},null,null,[[1,9]]);};// logout request \nvar logout=function logout(){dispatch({type:LOGOUT});};// clear error \nvar clearError=function clearError(){dispatch({type:CLEAR_ERRORS});};return React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,error:state.error,user:state.user,registerUser:registerUser,loadUser:loadUser,login:login,logout:logout,clearError:clearError}},props.children);};export default AuthState;","map":{"version":3,"sources":["D:/work/client/src/context/auth/authState.js"],"names":["React","useReducer","AuthContext","AuthReducer","axois","SetAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","error","user","state","dispatch","loadUser","get","res","type","payload","data","registerUser","FormData","config","headers","post","response","msg","login","logout","clearError","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\r\nimport AuthContext from './authContext';\r\nimport AuthReducer from './authReducer';\r\nimport axois from 'axios';\r\nimport SetAuthToken from '../../utils/setAuthToken';\r\nimport {\r\n    REGISTER_SUCCESS,\r\n    REGISTER_FAIL,\r\n    USER_LOADED,\r\n    AUTH_ERROR,\r\n    LOGIN_SUCESS,\r\n    LOGIN_FAIL,\r\n    LOGOUT,\r\n    CLEAR_ERRORS\r\n} from '../type';\r\n\r\n\r\nconst AuthState = (props) => {\r\n    const initialState = {\r\n        token: localStorage.getItem(\"token\"),\r\n        isAuthenticated: null,\r\n        loading: true,\r\n        error: null,\r\n        user: null\r\n    };\r\n    const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n\r\n    // load user \r\n    const loadUser = async () => {\r\n        if (localStorage.token)  SetAuthToken(localStorage.token)\r\n        try {\r\n            const res = await axois.get('/api/auth');\r\n            dispatch({type: USER_LOADED,payload: res.data})\r\n        } catch (err) {\r\n            dispatch({type: AUTH_ERROR})\r\n        };\r\n    };\r\n\r\n\r\n    // Register User \r\n    const registerUser = async FormData => {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        }\r\n        try {\r\n            const res = await axois.post('/api/users', FormData, config);\r\n            dispatch({\r\n                type: REGISTER_SUCCESS,\r\n                payload: res.data\r\n            })\r\n            loadUser();\r\n        } catch (err) {\r\n            dispatch({\r\n                type: REGISTER_FAIL,\r\n                payload: err.response.data.msg\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // Login user \r\n    const login = async FormData => {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        }\r\n        try {\r\n            const res = await axois.post('/api/auth', FormData, config);\r\n            dispatch({\r\n                type: LOGIN_SUCESS,\r\n                payload: res.data\r\n            })\r\n            loadUser();\r\n        } catch (err) {\r\n            dispatch({\r\n                type: LOGIN_FAIL,\r\n                payload: err.response.data.msg\r\n            });\r\n        };\r\n    };\r\n\r\n    // logout request \r\n    const logout = () => {\r\n        dispatch({\r\n            type: LOGOUT\r\n        });\r\n    };\r\n\r\n    // clear error \r\n    const clearError = () => {\r\n        dispatch({\r\n            type: CLEAR_ERRORS,\r\n        })\r\n    }\r\n\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                token: state.token,\r\n                isAuthenticated: state.isAuthenticated,\r\n                loading: state.loading,\r\n                error: state.error,\r\n                user: state.user,\r\n                registerUser,\r\n                loadUser,\r\n                login,\r\n                logout,\r\n                clearError\r\n            }}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    )\r\n};\r\n\r\n\r\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}